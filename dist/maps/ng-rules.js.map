{"version":3,"sources":["ng-rules.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","RulesService","$timeout","ruleFn","watchItems","_loop","watchExpressionList","rItems","rules","angular","isDefined","originName","isArray","source","forEach","item","index","push","watchFunction","$scope","undefined","watchItem","currentPrefix","createProp","result","$invalid","watchFn","$watch","value","isUndefined","_loop2","i","len","ri","layerItem","rItemMatchResult","params","map","param","type","_enumType","ParamType","PROPERTY","customRules","methodName","apply","concat","isReverse","length","_ret2","timeChecker","cancel","checkValid","watchList","cancelWatchItems","clear","setRule","ruleName","method","getInitResult","$eval","$watchCollection","val","extend","$setRule","originRules","copy","_regexCollection2","arguments","_analyzeOriginRules2","propStr","propVal","sp","split","node","spName","indexOf","exec","arrayItem","test","_p","$inject","Object","defineProperty","_regexCollection","_analyzeOriginRules","factory","required","number","email","maxLen","str","String","rps_value","replace","eq","orginVal","compareVal","equals","analyzeOriginRules","analyzeScope","newRules","ruleStr","np","updateRule","rItem","rsp","splice","VALUE","substr"],"mappings":"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","file":"ng-rules.js","sourceRoot":"/source/","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tRulesService.$inject = [\"$timeout\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\n\tvar _regexCollection = __webpack_require__(1);\n\n\tvar _regexCollection2 = _interopRequireDefault(_regexCollection);\n\n\tvar _analyzeOriginRules = __webpack_require__(2);\n\n\tvar _analyzeOriginRules2 = _interopRequireDefault(_analyzeOriginRules);\n\n\tvar _enumType = __webpack_require__(3);\n\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\tangular.module('ngRules', []).factory('$rules', RulesService);\n\n\tfunction RulesService($timeout) {\n\t    'ngInject';\n\n\t    function ruleFn() {\n\t        var $scope = void 0,\n\t            originName = void 0,\n\t            rules = void 0,\n\t            originRules = void 0,\n\t            timeChecker = void 0,\n\t            source = void 0,\n\t            result = void 0,\n\t            customRules = angular.copy(_regexCollection2.default);\n\n\t        //handle dynamic arguments\n\t        if (arguments.length === 2) {\n\t            $scope = arguments[0];\n\t            originRules = arguments[1];\n\t        } else {\n\t            $scope = arguments[0];\n\t            originName = arguments[1];\n\t            originRules = arguments[2];\n\t        }\n\n\t        result = getInitResult();\n\n\t        rules = (0, _analyzeOriginRules2.default)(originRules, $scope, originName);\n\n\t        var watchList = [];\n\n\t        watchItems();\n\n\t        return result;\n\n\t        function watchItems() {\n\t            var _loop = function _loop(p) {\n\t                var watchExpressionList = [],\n\t                    rItems = rules[p];\n\n\t                if (angular.isDefined(originName) && angular.isArray(source)) {\n\t                    source.forEach(function (item, index) {\n\t                        watchExpressionList.push({\n\t                            watchFunction: function watchFunction() {\n\t                                return item[p];\n\t                            },\n\t                            index: index,\n\t                            item: item\n\t                        });\n\t                    });\n\t                } else {\n\t                    watchExpressionList = [{\n\t                        watchFunction: function watchFunction() {\n\t                            return $scope[p];\n\t                        },\n\t                        index: undefined,\n\t                        item: $scope\n\t                    }];\n\t                }\n\n\t                watchExpressionList.forEach(function (watchItem) {\n\n\t                    var currentPrefix = angular.isDefined(watchItem.index) ? '[' + watchItem.index + '].' : '';\n\n\t                    createProp(result, '' + currentPrefix + p, { $invalid: false });\n\n\t                    var watchFn = $scope.$watch(watchItem.watchFunction, function (value) {\n\t                        if (angular.isUndefined(value)) {\n\t                            return;\n\t                        }\n\n\t                        var _loop2 = function _loop2(i, len) {\n\t                            var ri = rItems[i],\n\t                                layerItem = watchItem.item,\n\t                                rItemMatchResult = void 0;\n\n\t                            var params = ri.params.map(function (param) {\n\t                                if (param.type === _enumType.ParamType.PROPERTY) {\n\t                                    return layerItem[param.value];\n\t                                } else {\n\t                                    return param.value;\n\t                                }\n\t                            });\n\n\t                            rItemMatchResult = customRules[ri.methodName].apply(layerItem, [value].concat(params));\n\n\t                            if (ri.isReverse) {\n\t                                rItemMatchResult = !rItemMatchResult;\n\t                            }\n\n\t                            createProp(result, '' + currentPrefix + p + '.$invalid', !rItemMatchResult);\n\n\t                            if (!rItemMatchResult) {\n\t                                return 'break';\n\t                            }\n\t                        };\n\n\t                        for (var i = 0, len = rItems.length; i < len; i++) {\n\t                            var _ret2 = _loop2(i, len);\n\n\t                            if (_ret2 === 'break') break;\n\t                        }\n\n\t                        timeChecker && $timeout.cancel(timeChecker);\n\n\t                        timeChecker = $timeout(function () {\n\t                            checkValid(result);\n\t                        }, 60);\n\t                    });\n\n\t                    watchList.push(watchFn);\n\t                });\n\t            };\n\n\t            for (var p in rules) {\n\t                _loop(p);\n\t            }\n\t        }\n\n\t        function cancelWatchItems() {\n\t            watchList.forEach(function (clear) {\n\t                clear();\n\t            });\n\n\t            watchList = [];\n\t        }\n\n\t        function setRule(ruleName, method) {\n\t            customRules[ruleName] = method;\n\t        }\n\n\t        function getInitResult() {\n\t            var result = void 0;\n\n\t            if (angular.isDefined(originName) && angular.isArray(source = $scope.$eval(originName))) {\n\t                result = [];\n\t                $scope.$watchCollection(originName, function (val) {\n\t                    if (angular.isDefined(val)) {\n\t                        cancelWatchItems();\n\t                        watchItems();\n\t                    }\n\t                });\n\t            } else {\n\t                result = {};\n\t            }\n\n\t            angular.extend(result, {\n\t                $invalid: false,\n\t                $setRule: setRule\n\t            });\n\n\t            return result;\n\t        }\n\t    }\n\n\t    return ruleFn;\n\t}\n\n\tfunction createProp(obj, propStr, propVal) {\n\t    var sp = propStr.split('.');\n\t    var node = obj;\n\n\t    for (var i = 0, len = sp.length; i < len; i++) {\n\t        var spName = sp[i];\n\n\t        if (spName.indexOf('[') !== -1) {\n\t            spName = /[^\\[\\]]+/.exec(spName)[0];\n\t        }\n\n\t        if (angular.isUndefined(node[spName])) {\n\t            node[spName] = {};\n\t        }\n\n\t        if (i === len - 1) {\n\t            node[spName] = propVal;\n\t        } else {\n\t            node = node[spName];\n\t        }\n\t    }\n\t}\n\n\tfunction checkValid(obj) {\n\n\t    if (angular.isArray(obj)) {\n\t        for (var i = 0, len = obj.length; i < len; i++) {\n\t            var arrayItem = obj[i];\n\t            for (var p in arrayItem) {\n\t                if (/^$/.test(p)) {\n\t                    continue;\n\t                }\n\n\t                if (arrayItem[p].$invalid) {\n\t                    obj.$invalid = true;\n\t                    return;\n\t                }\n\t            }\n\t        }\n\t    } else {\n\t        for (var _p in obj) {\n\n\t            if (/^$/.test(_p)) {\n\t                continue;\n\t            }\n\n\t            if (obj[_p].$invalid) {\n\t                obj.$invalid = true;\n\t                return;\n\t            }\n\t        }\n\t    }\n\n\t    obj.$invalid = false;\n\t}\n\n\texports.default = RulesService;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.default = {\n\t    'required': function required(value) {\n\t        return !(angular.isUndefined(value) || value === null || /^\\s*$/.test(value));\n\t    },\n\t    'number': function number(value) {\n\t        return (/^-?\\d+(?:\\.\\d+)?$/.test(value)\n\t        );\n\t    },\n\t    'email': function email(value) {\n\t        return (/^(\\w+|\\.+)((-\\w+|\\.+)|(\\.+\\w+))*\\@\\w+((\\.|-)\\w+)*\\.\\w+/.test(value)\n\t        );\n\t    },\n\t    'maxLen': function maxLen(value, len) {\n\t        var str = String(value),\n\t            rps_value = str.replace(/^\\s+|\\s+$/g, '');\n\t        return rps_value.length <= len;\n\t    },\n\t    'eq': function eq(orginVal, compareVal) {\n\t        return angular.equals(orginVal, compareVal);\n\t    }\n\t};\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\n\tvar _enumType = __webpack_require__(3);\n\n\tfunction analyzeOriginRules(originRules, $scope, originName) {\n\t    var analyzeScope = void 0,\n\t        newRules = {};\n\n\t    if (originName) {\n\t        analyzeScope = $scope.$eval(originName);\n\t        if (angular.isArray(analyzeScope)) {\n\t            analyzeScope = analyzeScope[0];\n\t        }\n\t    } else {\n\t        analyzeScope = $scope;\n\t    }\n\n\t    for (var p in originRules) {\n\t        var ruleStr = originRules[p];\n\n\t        if (p === '*') {\n\t            for (var np in analyzeScope) {\n\t                updateRule(newRules, np, ruleStr);\n\t            }\n\t        } else {\n\t            updateRule(newRules, p, ruleStr);\n\t        }\n\t    }\n\n\t    return newRules;\n\t}\n\n\tfunction updateRule(rules, p, ruleStr) {\n\t    var sp = ruleStr.split(/\\s*\\|\\s*/);\n\n\t    if (angular.isUndefined(rules[p])) {\n\t        rules[p] = [];\n\t    }\n\n\t    var rItem = rules[p];\n\n\t    for (var i = 0, len = sp.length; i < len; i++) {\n\t        var rsp = sp[i].split(/\\s*:\\s*/),\n\t            methodName = rsp.splice(0, 1)[0].replace(/^\\s+|\\s+$/g, ''),\n\t            isReverse = false;\n\n\t        if (rsp.length > 0) {\n\t            rsp = rsp.map(function (item) {\n\t                var type = void 0;\n\n\t                if (/^\\s*['\"]|['\"]\\s*$/.test(item) || /^-?\\d+(?:\\.\\d+)?$/.test(item)) {\n\t                    type = _enumType.ParamType.VALUE;\n\t                } else {\n\t                    type = _enumType.ParamType.PROPERTY;\n\t                }\n\n\t                return {\n\t                    type: type,\n\t                    value: item.replace(/^\\s+|\\s+$/g, '').replace(/^['\"]|['\"]$/g, '')\n\t                };\n\t            });\n\t        }\n\n\t        if (methodName.indexOf('!') !== -1) {\n\t            isReverse = true;\n\t            methodName = methodName.substr(1);\n\t        }\n\n\t        rItem.push({\n\t            methodName: methodName,\n\t            params: rsp,\n\t            isReverse: isReverse\n\t        });\n\t    }\n\t}\n\n\texports.default = analyzeOriginRules;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\tvar ParamType = exports.ParamType = {\n\t    PROPERTY: 1,\n\t    VALUE: 2\n\t};\n\n/***/ }\n/******/ ]);"]}